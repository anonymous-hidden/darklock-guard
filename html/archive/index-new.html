<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DarkLock - Security Dashboard</title>
    <link rel="stylesheet" href="/css/cyber-theme.css">
    <link id="dynamic-theme-stylesheet" rel="stylesheet" href="">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="/js/global-theme.js"></script>
    <script src="/js/theme-effects.js"></script>
</head>
<body x-data="dashboard()" x-init="init()">
    <!-- Notification Container -->
    <div id="notifications-container" class="notifications-container"></div>
    
    <div class="dashboard-container">
        <!-- Debug Info -->
        <div style="background: var(--cyber-secondary); border: 1px solid var(--cyber-accent); border-radius: var(--radius-md); padding: var(--spacing-sm); margin-bottom: var(--spacing-md); font-size: 0.8rem;">
            üü¢ Dashboard Status: <span style="color: var(--cyber-accent);">ACTIVE</span> | 
            Alpine.js: <span x-text="'Loaded'">Loading...</span> | 
            Active Tab: <span x-text="activeTab || 'dashboard'" style="color: var(--cyber-accent);">dashboard</span>
        </div>
        
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="logo">üõ°Ô∏è</div>
                <div class="sidebar-title">DarkLock</div>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="javascript:void(0)" onclick="setActiveTab('dashboard')" 
                       class="nav-link"
                       :class="{ active: activeTab === 'dashboard' }">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="javascript:void(0)" onclick="setActiveTab('security')" 
                       class="nav-link"
                       :class="{ active: activeTab === 'security' }">
                        <i class="fas fa-shield-alt"></i>
                        <span>Security</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="javascript:void(0)" onclick="setActiveTab('analytics')" 
                       class="nav-link"
                       :class="{ active: activeTab === 'analytics' }">
                        <i class="fas fa-chart-bar"></i>
                        <span>Analytics</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="javascript:void(0)" onclick="setActiveTab('logs')" 
                       class="nav-link"
                       :class="{ active: activeTab === 'logs' }">
                        <i class="fas fa-file-alt"></i>
                        <span>Security Logs</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" @click="setActiveTab('settings')" 
                       class="nav-link"
                       :class="{ active: activeTab === 'settings' }">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" @click="setActiveTab('setup-wizard')" 
                       class="nav-link"
                       :class="{ active: activeTab === 'setup-wizard' }">
                        <i class="fas fa-magic"></i>
                        <span>Setup Wizard</span>
                    </a>
                </li>
            </ul>
            
            <div style="margin-top: auto; padding-top: var(--spacing-lg); border-top: 1px solid var(--border-color);">
                <div class="server-info">
                    <div style="display: flex; align-items: center; margin-bottom: var(--spacing-md);">
                        <img :src="serverIcon" alt="Server" style="width: 32px; height: 32px; border-radius: 50%; margin-right: var(--spacing-sm);">
                        <div>
                            <div style="font-weight: 600; font-size: 0.9rem;" x-text="serverName"></div>
                            <div style="color: var(--text-muted); font-size: 0.8rem;">Connected</div>
                        </div>
                    </div>
                    <button @click="logout()" class="btn-danger" style="width: 100%; font-size: 0.8rem;">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content" style="margin-left: 280px; padding: var(--spacing-lg); min-height: 100vh; background: var(--cyber-primary);">
            <!-- Dashboard Tab -->
            <div x-show="activeTab === 'dashboard'" class="tab-content" style="display: block !important; opacity: 1; visibility: visible;">
                <div class="page-header" style="margin-bottom: var(--spacing-xl); padding: var(--spacing-lg); background: var(--cyber-secondary); border-radius: var(--radius-lg); border: 1px solid var(--border-color);">
                    <h1 class="page-title" style="color: var(--cyber-accent); font-size: 2.5rem; font-weight: bold; margin: 0 0 var(--spacing-md) 0; text-shadow: 0 0 10px rgba(0, 255, 255, 0.3);">Security Dashboard</h1>
                    <p style="color: var(--text-muted); margin: var(--spacing-sm) 0; font-size: 1.1rem;">
                        üõ°Ô∏è <strong style="color: var(--cyber-accent);">DarkLock</strong> is actively protecting your server
                    </p>
                    <div class="header-actions" style="display: flex; gap: var(--spacing-md);">
                        <button onclick="performAction('loadData')" class="btn-secondary" style="background: var(--cyber-blue); color: white; border: none; padding: var(--spacing-md) var(--spacing-lg); border-radius: var(--radius-md); font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-sync-alt"></i> 
                            <span>Refresh</span>
                        </button>
                        <button onclick="performAction('toggleAutoRefresh')" style="background: var(--success-green); color: white; border: none; padding: var(--spacing-md) var(--spacing-lg); border-radius: var(--radius-md); font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-broadcast-tower"></i>
                            <span>Auto-Refresh</span>
                        </button>
                    </div>
                </div>
                
                <!-- Status Overview -->
                <div class="grid-4" style="margin-bottom: var(--spacing-xl); display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--spacing-lg);">
                    <!-- Security Score -->
                    <div class="card security-score" style="background: var(--cyber-secondary); border: 1px solid var(--border-color); border-radius: var(--radius-lg); padding: var(--spacing-lg); text-align: center;">
                        <div class="score-circle" style="margin: 0 auto var(--spacing-md); width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, var(--cyber-accent), var(--cyber-blue)); display: flex; align-items: center; justify-content: center;">
                            <div class="score-number" x-text="securityScore || '87'" style="font-size: 1.8rem; font-weight: bold; color: white;">87</div>
                        </div>
                        <div class="score-label" x-text="getProtectionLevel(securityScore || 87) || 'High Security'" style="font-weight: 600; color: var(--text-primary); margin-bottom: var(--spacing-sm);">High Security</div>
                        <div style="margin-top: var(--spacing-sm); color: var(--text-muted); font-size: 0.8rem;">
                            Security Score
                        </div>
                    </div>
                    
                    <!-- Server Status -->
                    <div class="card" style="background: var(--cyber-secondary); border: 1px solid var(--border-color); border-radius: var(--radius-lg); padding: var(--spacing-lg); text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: var(--spacing-md);">
                            <i class="fas fa-server" style="color: var(--success-green);"></i>
                        </div>
                        <div style="font-weight: 600; margin-bottom: var(--spacing-sm); color: var(--text-primary);">Online</div>
                        <div style="color: var(--text-muted); font-size: 0.8rem;">Bot Status</div>
                    </div>
                    
                    <!-- Active Threats -->
                    <div class="card" style="background: var(--cyber-secondary); border: 1px solid var(--border-color); border-radius: var(--radius-lg); padding: var(--spacing-lg); text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: var(--spacing-md); color: var(--success-green);">
                            <span x-text="totalThreats || '0'">0</span>
                        </div>
                        <div style="font-weight: 600; margin-bottom: var(--spacing-sm); color: var(--text-primary);">Active Threats</div>
                        <div style="color: var(--text-muted); font-size: 0.8rem;">All Clear</div>
                    </div>
                    
                    <!-- Protected Members -->
                    <div class="card" style="background: var(--cyber-secondary); border: 1px solid var(--border-color); border-radius: var(--radius-lg); padding: var(--spacing-lg); text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: var(--spacing-md); color: var(--cyber-accent);">
                            <span x-text="memberCount || '1,247'">1,247</span>
                        </div>
                        <div style="font-weight: 600; margin-bottom: var(--spacing-sm); color: var(--text-primary);">Protected</div>
                        <div style="color: var(--text-muted); font-size: 0.8rem;">Server Members</div>
                    </div>
                </div>
                
                <!-- Activity Overview -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-lg); margin-bottom: var(--spacing-xl);">
                    <!-- Threat Trends Chart -->
                    <div class="card" style="background: var(--cyber-secondary); border: 1px solid var(--border-color); border-radius: var(--radius-lg); padding: var(--spacing-lg);">
                        <div class="card-header" style="margin-bottom: var(--spacing-lg); border-bottom: 1px solid var(--border-color); padding-bottom: var(--spacing-md);">
                            <h3 style="color: var(--text-primary); font-weight: 600; margin: 0; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-chart-line" style="color: var(--cyber-accent);"></i>
                                Threat Trends
                            </h3>
                        </div>
                        <div class="chart-container" style="position: relative; height: 300px;">
                            <canvas id="threatTrendChart" width="400" height="300"></canvas>
                        </div>
                    </div>
                    
                    <!-- Server Activity Chart -->
                    <div class="card" style="background: var(--cyber-secondary); border: 1px solid var(--border-color); border-radius: var(--radius-lg); padding: var(--spacing-lg);">
                        <div class="card-header" style="margin-bottom: var(--spacing-lg); border-bottom: 1px solid var(--border-color); padding-bottom: var(--spacing-md);">
                            <h3 style="color: var(--text-primary); font-weight: 600; margin: 0; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-chart-bar" style="color: var(--cyber-blue);"></i>
                                Server Activity
                            </h3>
                        </div>
                        <div class="chart-container" style="position: relative; height: 300px;">
                            <canvas id="activityChart" width="400" height="300"></canvas>
                        </div>
                    </div>
                </div>

                <div class="grid-3" style="margin-bottom: var(--spacing-xl);">
                    <!-- Current Threats -->
                    <div class="card">
                        <h3 style="margin-bottom: var(--spacing-lg); color: var(--cyber-accent);">
                            <i class="fas fa-exclamation-triangle"></i> Active Threats
                        </h3>
                        <div style="max-height: 300px; overflow-y: auto;">
                            <!-- Always visible sample threat -->
                            <div class="threat-item" style="margin-bottom: var(--spacing-sm);">
                                <div class="threat-icon">
                                    <i class="fas fa-info-circle"></i>
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 600;">System Status</div>
                                    <div style="color: var(--text-secondary); font-size: 0.9rem;">
                                        <span>Count: 0</span>
                                        <span class="status-low" style="text-transform: uppercase; margin-left: var(--spacing-sm);">LOW</span>
                                    </div>
                                </div>
                                <button class="btn-secondary" style="font-size: 0.8rem;">
                                    ‚úì OK
                                </button>
                            </div>
                            
                            <!-- Dynamic threats -->
                            <template x-for="threat in (currentThreats || [])" :key="threat.id">
                                <div class="threat-item" style="margin-bottom: var(--spacing-sm);">
                                    <div class="threat-icon">
                                        <i :class="threat.icon"></i>
                                    </div>
                                    <div style="flex: 1;">
                                        <div x-text="threat.title" style="font-weight: 600;"></div>
                                        <div style="color: var(--text-secondary); font-size: 0.9rem;">
                                            <span x-text="'Count: ' + threat.count"></span>
                                            <span :class="'status-' + threat.level" x-text="threat.level" style="text-transform: uppercase; margin-left: var(--spacing-sm);"></span>
                                        </div>
                                    </div>
                                    <button @click="resolveThreat(threat.id)" class="btn-secondary" style="font-size: 0.8rem;">
                                        Resolve
                                    </button>
                                </div>
                            </template>
                        </div>
                    </div>
                    
                    <!-- Recent Activity -->
                    <div class="card">
                        <h3 style="margin-bottom: var(--spacing-lg); color: var(--cyber-accent);">
                            <i class="fas fa-clock"></i> Recent Activity
                        </h3>
                        <div style="max-height: 300px; overflow-y: auto;">
                            <!-- Always visible sample activity -->
                            <div style="display: flex; align-items: center; padding: var(--spacing-sm) 0; border-bottom: 1px solid var(--border-color);">
                                <i class="fas fa-check" style="color: var(--cyber-accent)"></i>
                                <div style="margin-left: var(--spacing-md); flex: 1;">
                                    <div style="font-size: 0.9rem;">DarkLock started successfully</div>
                                    <div style="color: var(--text-muted); font-size: 0.8rem;">Just now</div>
                                </div>
                            </div>
                            
                            <div style="display: flex; align-items: center; padding: var(--spacing-sm) 0; border-bottom: 1px solid var(--border-color);">
                                <i class="fas fa-shield-alt" style="color: var(--cyber-accent)"></i>
                                <div style="margin-left: var(--spacing-md); flex: 1;">
                                    <div style="font-size: 0.9rem;">Security systems initialized</div>
                                    <div style="color: var(--text-muted); font-size: 0.8rem;">2 minutes ago</div>
                                </div>
                            </div>
                            
                            <!-- Dynamic activity -->
                            <template x-for="incident in (recentIncidents || [])" :key="incident.id">
                                <div style="display: flex; align-items: center; padding: var(--spacing-sm) 0; border-bottom: 1px solid var(--border-color);">
                                    <i :class="incident.statusIcon" 
                                       :style="'color: ' + (incident.status === 'resolved' ? 'var(--cyber-accent)' : 'var(--alert-yellow)')"></i>
                                    <div style="margin-left: var(--spacing-md); flex: 1;">
                                        <div x-text="incident.description" style="font-size: 0.9rem;"></div>
                                        <div x-text="formatTime && formatTime(incident.time)" style="color: var(--text-muted); font-size: 0.8rem;"></div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
                
                <!-- Charts Section -->
                <div class="grid-2">
                    <div class="card">
                        <h3 style="margin-bottom: var(--spacing-lg); color: var(--cyber-accent);">
                            <i class="fas fa-chart-line"></i> Activity Overview
                        </h3>
                        <canvas id="activityChart" width="400" height="200"></canvas>
                    </div>
                    
                    <!-- Security Events -->
                    <div class="card" style="background: var(--cyber-secondary); border: 1px solid var(--border-color); border-radius: var(--radius-lg); padding: var(--spacing-lg);">
                        <h3 style="margin-bottom: var(--spacing-lg); color: var(--cyber-accent); display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-shield-alt"></i> Security Events
                        </h3>
                        <div class="events-list" style="max-height: 300px; overflow-y: auto;">
                            <!-- Event Item -->
                            <div class="event-item" style="display: flex; align-items: center; padding: var(--spacing-md); margin-bottom: var(--spacing-sm); background: rgba(74, 222, 128, 0.1); border-left: 4px solid var(--success-green); border-radius: var(--radius-md);">
                                <div class="event-icon" style="width: 40px; height: 40px; background: var(--success-green); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: var(--spacing-md);">
                                    <i class="fas fa-shield-alt" style="color: white;"></i>
                                </div>
                                <div class="event-content" style="flex: 1;">
                                    <div class="event-title" style="font-weight: 600; color: var(--text-primary); margin-bottom: 4px;">Anti-Raid Protection</div>
                                    <div class="event-description" style="color: var(--text-muted); font-size: 0.9rem;">Detected suspicious joins</div>
                                </div>
                                <div class="event-time" style="color: var(--text-muted); font-size: 0.8rem;">2 mins ago</div>
                            </div>
                            
                            <div class="event-item" style="display: flex; align-items: center; padding: var(--spacing-md); margin-bottom: var(--spacing-sm); background: rgba(239, 68, 68, 0.1); border-left: 4px solid var(--error-red); border-radius: var(--radius-md);">
                                <div class="event-icon" style="width: 40px; height: 40px; background: var(--error-red); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: var(--spacing-md);">
                                    <i class="fas fa-ban" style="color: white;"></i>
                                </div>
                                <div class="event-content" style="flex: 1;">
                                    <div class="event-title" style="font-weight: 600; color: var(--text-primary); margin-bottom: 4px;">User Banned</div>
                                    <div class="event-description" style="color: var(--text-muted); font-size: 0.9rem;">Banned @SpamBot123</div>
                                </div>
                                <div class="event-time" style="color: var(--text-muted); font-size: 0.8rem;">5 mins ago</div>
                            </div>
                            
                            <div class="event-item" style="display: flex; align-items: center; padding: var(--spacing-md); margin-bottom: var(--spacing-sm); background: rgba(245, 158, 11, 0.1); border-left: 4px solid var(--warning-yellow); border-radius: var(--radius-md);">
                                <div class="event-icon" style="width: 40px; height: 40px; background: var(--warning-yellow); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: var(--spacing-md);">
                                    <i class="fas fa-exclamation-triangle" style="color: white;"></i>
                                </div>
                                <div class="event-content" style="flex: 1;">
                                    <div class="event-title" style="font-weight: 600; color: var(--text-primary); margin-bottom: 4px;">Phishing Blocked</div>
                                    <div class="event-description" style="color: var(--text-muted); font-size: 0.9rem;">Blocked malicious link</div>
                                </div>
                                <div class="event-time" style="color: var(--text-muted); font-size: 0.8rem;">12 mins ago</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions Section (Bottom) -->
                <div style="margin-bottom: var(--spacing-xl);">
                    <div class="card">
                        <h3 style="margin-bottom: var(--spacing-lg); color: var(--cyber-accent);">
                            <i class="fas fa-bolt"></i> Quick Actions
                        </h3>
                        <div style="display: flex; flex-direction: row; gap: var(--spacing-md); flex-wrap: wrap; justify-content: flex-start;">
                            <button onclick="performAction('lockdown')" 
                                    class="btn-primary"
                                    style="display: inline-flex; align-items: center; gap: 8px; background: var(--cyber-accent); color: white; border: none; padding: var(--spacing-md) var(--spacing-lg); border-radius: var(--radius-md); cursor: pointer; font-size: 0.95rem;">
                                <i class="fas fa-lock"></i>
                                <span>Enable Lockdown</span>
                            </button>
                            
                            <button onclick="performAction('pauseInvites')" 
                                    class="btn-secondary"
                                    style="display: inline-flex; align-items: center; gap: 8px; background: var(--cyber-blue); color: white; border: none; padding: var(--spacing-md) var(--spacing-lg); border-radius: var(--radius-md); cursor: pointer; font-size: 0.95rem;">
                                <i class="fas fa-user-plus"></i>
                                <span>Pause Invites</span>
                            </button>
                            
                            <button onclick="performAction('clearRaidFlags')" 
                                    class="btn-secondary"
                                    style="display: inline-flex; align-items: center; gap: 8px; background: var(--warning-yellow); color: white; border: none; padding: var(--spacing-md) var(--spacing-lg); border-radius: var(--radius-md); cursor: pointer; font-size: 0.95rem;">
                                <i class="fas fa-eraser"></i>
                                <span>Clear Raid Flags</span>
                            </button>
                            
                            <button onclick="performAction('emergencyMode')" 
                                    class="btn-warning"
                                    style="display: inline-flex; align-items: center; gap: 8px; background: var(--error-red); color: white; border: none; padding: var(--spacing-md) var(--spacing-lg); border-radius: var(--radius-md); cursor: pointer; font-size: 0.95rem;">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span>Emergency Mode</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Security Tab -->
            <div x-show="activeTab === 'security'" class="tab-content">
                <div class="page-header">
                    <h1 class="page-title">Security Settings</h1>
                </div>
                
                <div class="grid-2">
                    <!-- Anti-Raid Protection -->
                    <div class="card">
                        <h3 style="margin-bottom: var(--spacing-lg); color: var(--cyber-accent);">
                            <i class="fas fa-users-slash"></i> Anti-Raid Protection
                        </h3>
                        <div class="setting-item">
                            <label>Enable Anti-Raid</label>
                            <input type="checkbox" x-model="securitySettings.antiRaid" @change="updateSecuritySettings()">
                        </div>
                        <div class="setting-item">
                            <label>Join Threshold (users per minute)</label>
                            <input type="number" x-model="securitySettings.raidThreshold" @change="updateSecuritySettings()">
                        </div>
                        <div class="setting-item">
                            <label>Auto-Ban Raid Members</label>
                            <input type="checkbox" x-model="securitySettings.autoBanRaid" @change="updateSecuritySettings()">
                        </div>
                    </div>
                    
                    <!-- Anti-Spam -->
                    <div class="card">
                        <h3 style="margin-bottom: var(--spacing-lg); color: var(--cyber-accent);">
                            <i class="fas fa-comment-slash"></i> Anti-Spam
                        </h3>
                        <div class="setting-item">
                            <label>Enable Anti-Spam</label>
                            <input type="checkbox" x-model="securitySettings.antiSpam" @change="updateSecuritySettings()">
                        </div>
                        <div class="setting-item">
                            <label>Message Limit (per 5 seconds)</label>
                            <input type="number" x-model="securitySettings.messageLimit" @change="updateSecuritySettings()">
                        </div>
                        <div class="setting-item">
                            <label>Auto-Timeout Duration (minutes)</label>
                            <input type="number" x-model="securitySettings.timeoutDuration" @change="updateSecuritySettings()">
                        </div>
                    </div>
                    
                    <!-- Link Protection -->
                    <div class="card">
                        <h3 style="margin-bottom: var(--spacing-lg); color: var(--cyber-accent);">
                            <i class="fas fa-link"></i> Link Protection
                        </h3>
                        <div class="setting-item">
                            <label>Enable Link Scanning</label>
                            <input type="checkbox" x-model="securitySettings.linkScanning" @change="updateSecuritySettings()">
                        </div>
                        <div class="setting-item">
                            <label>Block Suspicious Links</label>
                            <input type="checkbox" x-model="securitySettings.blockSuspicious" @change="updateSecuritySettings()">
                        </div>
                        <div class="setting-item">
                            <label>Allowed Domains (comma separated)</label>
                            <textarea x-model="securitySettings.allowedDomains" @change="updateSecuritySettings()" 
                                      style="min-height: 80px;" placeholder="discord.com, youtube.com, github.com"></textarea>
                        </div>
                    </div>
                    
                    <!-- Member Verification -->
                    <div class="card">
                        <h3 style="margin-bottom: var(--spacing-lg); color: var(--cyber-accent);">
                            <i class="fas fa-user-check"></i> Member Verification
                        </h3>
                        <div class="setting-item">
                            <label>Minimum Account Age (hours)</label>
                            <input type="number" x-model="securitySettings.minAccountAge" @change="updateSecuritySettings()">
                        </div>
                        <div class="setting-item">
                            <label>Require Avatar</label>
                            <input type="checkbox" x-model="securitySettings.requireAvatar" @change="updateSecuritySettings()">
                        </div>
                        <div class="setting-item">
                            <label>Auto-Assign Role</label>
                            <select x-model="securitySettings.autoRole" @change="updateSecuritySettings()">
                                <option value="">None</option>
                                <option value="member">Member</option>
                                <option value="verified">Verified</option>
                                <option value="newcomer">Newcomer</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Analytics Tab -->
            <div x-show="activeTab === 'analytics'" class="tab-content">
                <div class="page-header">
                    <h1 class="page-title">Security Analytics</h1>
                    <div class="header-actions">
                        <select x-model="analyticsTimeframe" @change="loadAnalytics()">
                            <option value="24h">Last 24 Hours</option>
                            <option value="7d">Last 7 Days</option>
                            <option value="30d">Last 30 Days</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid-3" style="margin-bottom: var(--spacing-xl);">
                    <div class="card" style="text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: var(--spacing-md); color: var(--alert-red);">
                            <span x-text="analytics.threatsBlocked"></span>
                        </div>
                        <div style="font-weight: 600;">Threats Blocked</div>
                        <div style="color: var(--text-muted); font-size: 0.8rem;" x-text="analyticsTimeframe"></div>
                    </div>
                    
                    <div class="card" style="text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: var(--spacing-md); color: var(--cyber-blue);">
                            <span x-text="analytics.messagesScanned"></span>
                        </div>
                        <div style="font-weight: 600;">Messages Scanned</div>
                        <div style="color: var(--text-muted); font-size: 0.8rem;" x-text="analyticsTimeframe"></div>
                    </div>
                    
                    <div class="card" style="text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: var(--spacing-md); color: var(--cyber-accent);">
                            <span x-text="analytics.usersVerified"></span>
                        </div>
                        <div style="font-weight: 600;">Users Verified</div>
                        <div style="color: var(--text-muted); font-size: 0.8rem;" x-text="analyticsTimeframe"></div>
                    </div>
                </div>
                
                <div class="grid-2">
                    <div class="card">
                        <h3 style="margin-bottom: var(--spacing-lg); color: var(--cyber-accent);">
                            <i class="fas fa-chart-area"></i> Threat Trends
                        </h3>
                        <canvas id="threatTrendChart" width="400" height="300"></canvas>
                    </div>
                    
                    <div class="card">
                        <h3 style="margin-bottom: var(--spacing-lg); color: var(--cyber-accent);">
                            <i class="fas fa-chart-bar"></i> Top Threat Types
                        </h3>
                        <div style="max-height: 300px; overflow-y: auto;">
                            <template x-for="(threat, index) in analytics.topThreats" :key="index">
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--spacing-sm) 0; border-bottom: 1px solid var(--border-color);">
                                    <div>
                                        <div x-text="threat.type" style="font-weight: 600;"></div>
                                        <div x-text="threat.description" style="color: var(--text-muted); font-size: 0.9rem;"></div>
                                    </div>
                                    <div style="font-weight: 600; color: var(--alert-red);" x-text="threat.count"></div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Logs Tab -->
            <div x-show="activeTab === 'logs'" class="tab-content">
                <div class="page-header">
                    <h1 class="page-title">Security Logs</h1>
                    <div class="header-actions">
                        <select x-model="logFilter" @change="loadLogs()">
                            <option value="all">All Events</option>
                            <option value="threats">Threats Only</option>
                            <option value="actions">Actions Only</option>
                            <option value="errors">Errors Only</option>
                        </select>
                        <button @click="exportLogs()" class="btn-secondary">
                            <i class="fas fa-download"></i> Export
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div style="max-height: 600px; overflow-y: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead style="background: var(--cyber-tertiary); position: sticky; top: 0;">
                                <tr>
                                    <th style="padding: var(--spacing-md); text-align: left; border-bottom: 1px solid var(--border-color);">Time</th>
                                    <th style="padding: var(--spacing-md); text-align: left; border-bottom: 1px solid var(--border-color);">Event</th>
                                    <th style="padding: var(--spacing-md); text-align: left; border-bottom: 1px solid var(--border-color);">User</th>
                                    <th style="padding: var(--spacing-md); text-align: left; border-bottom: 1px solid var(--border-color);">Action</th>
                                    <th style="padding: var(--spacing-md); text-align: left; border-bottom: 1px solid var(--border-color);">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="log in securityLogs" :key="log.id">
                                    <tr style="border-bottom: 1px solid var(--border-color);">
                                        <td style="padding: var(--spacing-md);" x-text="formatLogTime(log.timestamp)"></td>
                                        <td style="padding: var(--spacing-md);" x-text="log.event"></td>
                                        <td style="padding: var(--spacing-md);" x-text="log.user || 'System'"></td>
                                        <td style="padding: var(--spacing-md);" x-text="log.action"></td>
                                        <td style="padding: var(--spacing-md);">
                                            <span :class="'status-' + log.status.toLowerCase()" x-text="log.status"></span>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Settings Tab -->
            <div x-show="activeTab === 'settings'" class="tab-content">
                <div class="page-header">
                    <h1 class="page-title">Bot Settings</h1>
                </div>
                
                <div class="grid-2">
                    <div class="card">
                        <h3 style="margin-bottom: var(--spacing-lg); color: var(--cyber-accent);">
                            <i class="fas fa-cog"></i> General Settings
                        </h3>
                        <div class="setting-item">
                            <label>Bot Prefix</label>
                            <input type="text" x-model="botSettings.prefix" @change="updateBotSettings()">
                        </div>
                        <div class="setting-item">
                            <label>Default Action on Violation</label>
                            <select x-model="botSettings.defaultAction" @change="updateBotSettings()">
                                <option value="warn">Warn</option>
                                <option value="timeout">Timeout</option>
                                <option value="kick">Kick</option>
                                <option value="ban">Ban</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label>Log Channel</label>
                            <select x-model="botSettings.logChannel" @change="updateBotSettings()">
                                <option value="">Select Channel</option>
                                <template x-for="channel in channels" :key="channel.id">
                                    <option :value="channel.id" x-text="channel.name"></option>
                                </template>
                            </select>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 style="margin-bottom: var(--spacing-lg); color: var(--cyber-accent);">
                            <i class="fas fa-bell"></i> Notifications
                        </h3>
                        <div class="setting-item">
                            <label>Alert Staff on Threats</label>
                            <input type="checkbox" x-model="botSettings.alertStaff" @change="updateBotSettings()">
                        </div>
                        <div class="setting-item">
                            <label>DM Users on Action</label>
                            <input type="checkbox" x-model="botSettings.dmUsers" @change="updateBotSettings()">
                        </div>
                        <div class="setting-item">
                            <label>Staff Role</label>
                            <select x-model="botSettings.staffRole" @change="updateBotSettings()">
                                <option value="">Select Role</option>
                                <template x-for="role in roles" :key="role.id">
                                    <option :value="role.id" x-text="role.name"></option>
                                </template>
                            </select>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 style="margin-bottom: var(--spacing-lg); color: var(--cyber-accent);">
                            <i class="fas fa-key"></i> API Keys
                        </h3>
                        <div class="setting-item">
                            <label>VirusTotal API Key</label>
                            <input type="password" x-model="apiKeys.virusTotal" @change="updateApiKeys()" placeholder="Enter API key for link scanning">
                        </div>
                        <div class="setting-item">
                            <label>URLVoid API Key</label>
                            <input type="password" x-model="apiKeys.urlVoid" @change="updateApiKeys()" placeholder="Optional secondary scanning">
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 style="margin-bottom: var(--spacing-lg); color: var(--cyber-accent);">
                            <i class="fas fa-database"></i> Data Management
                        </h3>
                        <div style="display: flex; flex-direction: column; gap: var(--spacing-md);">
                            <button @click="exportSettings()" class="btn-secondary">
                                <i class="fas fa-download"></i> Export Settings
                            </button>
                            <button @click="clearLogs()" class="btn-danger" @click="if(confirm('Clear all logs? This cannot be undone.')) clearLogs()">
                                <i class="fas fa-trash"></i> Clear Logs
                            </button>
                            <button @click="resetSettings()" class="btn-danger" @click="if(confirm('Reset to defaults? This will overwrite current settings.')) resetSettings()">
                                <i class="fas fa-undo"></i> Reset to Defaults
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Setup Wizard Tab -->
            <div x-show="activeTab === 'setup-wizard'" class="tab-content">
                <div class="page-header">
                    <h1 class="page-title">Setup Wizard</h1>
                </div>
                
                <div class="card" style="max-width: 800px; margin: 0 auto;">
                    <div style="text-align: center; margin-bottom: var(--spacing-xl);">
                        <h2 style="color: var(--cyber-accent); margin-bottom: var(--spacing-md);">
                            Configure DarkLock
                        </h2>
                        <p style="color: var(--text-secondary);">
                            Step <span x-text="wizardStep"></span> of 3: Choose your server type and customize protection settings
                        </p>
                        
                        <!-- Progress Bar -->
                        <div style="width: 100%; background: var(--cyber-tertiary); height: 4px; border-radius: 2px; margin-top: var(--spacing-lg); overflow: hidden;">
                            <div style="height: 100%; background: linear-gradient(90deg, var(--cyber-accent), var(--cyber-blue)); transition: width var(--transition-medium);"
                                 :style="'width: ' + (wizardStep / 3 * 100) + '%'"></div>
                        </div>
                    </div>
                    
                    <!-- Step 1: Server Type -->
                    <div x-show="wizardStep === 1">
                        <h3 style="margin-bottom: var(--spacing-lg); color: var(--cyber-accent); text-align: center;">
                            Select Your Server Type
                        </h3>
                        <div class="grid-2" style="gap: var(--spacing-md);">
                            <template x-for="serverType in serverTypes" :key="serverType.id">
                                <div @click="selectedServerType = serverType.id" 
                                     :class="{ 'border-cyber-accent': selectedServerType === serverType.id }"
                                     style="padding: var(--spacing-lg); border: 2px solid var(--border-color); border-radius: var(--radius-md); cursor: pointer; transition: var(--transition-fast);"
                                     :style="selectedServerType === serverType.id ? 'border-color: var(--cyber-accent); box-shadow: var(--shadow-glow);' : ''"
                                     class="card">
                                    <div style="display: flex; align-items: center; margin-bottom: var(--spacing-md);">
                                        <i :class="serverType.icon" style="font-size: 2rem; color: var(--cyber-accent); margin-right: var(--spacing-md);"></i>
                                        <div>
                                            <h4 x-text="serverType.name" style="color: var(--text-primary); margin-bottom: var(--spacing-sm);"></h4>
                                            <p x-text="serverType.description" style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;"></p>
                                        </div>
                                    </div>
                                    <div>
                                        <strong style="color: var(--cyber-accent);">Features:</strong>
                                        <ul style="margin-top: var(--spacing-sm); color: var(--text-secondary); font-size: 0.9rem;">
                                            <template x-for="feature in serverType.features" :key="feature">
                                                <li x-text="feature" style="margin-bottom: var(--spacing-xs);"></li>
                                            </template>
                                        </ul>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                    
                    <!-- Step 2: Security Settings -->
                    <div x-show="wizardStep === 2">
                        <h3 style="margin-bottom: var(--spacing-lg); color: var(--cyber-accent); text-align: center;">
                            Configure Security Level
                        </h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-lg);">
                            <div>
                                <label style="display: block; margin-bottom: var(--spacing-md);">
                                    <strong>Minimum Account Age (hours)</strong>
                                    <input type="number" x-model="memberSettings.minAccountAge" style="margin-top: var(--spacing-sm);">
                                </label>
                                <label style="display: block; margin-bottom: var(--spacing-md);">
                                    <input type="checkbox" x-model="memberSettings.flagNewAccounts" style="margin-right: var(--spacing-sm);">
                                    Flag new accounts for review
                                </label>
                                <label style="display: block; margin-bottom: var(--spacing-md);">
                                    <input type="checkbox" x-model="memberSettings.requireCaptcha" style="margin-right: var(--spacing-sm);">
                                    Require CAPTCHA verification
                                </label>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: var(--spacing-md);">
                                    <input type="checkbox" x-model="memberSettings.autoAssignRole" style="margin-right: var(--spacing-sm);">
                                    Auto-assign member role
                                </label>
                                <label style="display: block; margin-bottom: var(--spacing-md);">
                                    <strong>Raid Detection Threshold</strong>
                                    <input type="number" x-model="wizardSettings.raidThreshold" style="margin-top: var(--spacing-sm);" placeholder="10">
                                </label>
                                <label style="display: block; margin-bottom: var(--spacing-md);">
                                    <strong>Spam Message Limit</strong>
                                    <input type="number" x-model="wizardSettings.spamLimit" style="margin-top: var(--spacing-sm);" placeholder="5">
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Step 3: Review & Finish -->
                    <div x-show="wizardStep === 3">
                        <h3 style="margin-bottom: var(--spacing-lg); color: var(--cyber-accent); text-align: center;">
                            Review Configuration
                        </h3>
                        <div style="background: var(--cyber-tertiary); padding: var(--spacing-lg); border-radius: var(--radius-md); margin-bottom: var(--spacing-lg);">
                            <div style="margin-bottom: var(--spacing-md);">
                                <strong style="color: var(--cyber-accent);">Server Type:</strong>
                                <span x-text="serverTypes.find(s => s.id === selectedServerType)?.name" style="margin-left: var(--spacing-sm);"></span>
                            </div>
                            <div style="margin-bottom: var(--spacing-md);">
                                <strong style="color: var(--cyber-accent);">Account Age Requirement:</strong>
                                <span x-text="memberSettings.minAccountAge + ' hours'" style="margin-left: var(--spacing-sm);"></span>
                            </div>
                            <div style="margin-bottom: var(--spacing-md);">
                                <strong style="color: var(--cyber-accent);">Security Features:</strong>
                                <ul style="margin-left: var(--spacing-lg); margin-top: var(--spacing-sm);">
                                    <li x-show="memberSettings.flagNewAccounts">New account flagging</li>
                                    <li x-show="memberSettings.requireCaptcha">CAPTCHA verification</li>
                                    <li x-show="memberSettings.autoAssignRole">Auto role assignment</li>
                                    <li>Anti-raid protection</li>
                                    <li>Anti-spam filtering</li>
                                    <li>Malicious link detection</li>
                                </ul>
                            </div>
                        </div>
                        <div style="text-align: center; color: var(--text-secondary);">
                            <i class="fas fa-info-circle"></i>
                            You can modify these settings later in the Security tab
                        </div>
                    </div>
                    
                    <!-- Navigation -->
                    <div style="display: flex; justify-content: space-between; margin-top: var(--spacing-xl); padding-top: var(--spacing-lg); border-top: 1px solid var(--border-color);">
                        <button @click="previousStep()" 
                                x-show="wizardStep > 1" 
                                class="btn-secondary">
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <div x-show="wizardStep === 1"></div>
                        
                        <button @click="nextStep()" 
                                x-show="wizardStep < 3" 
                                :disabled="wizardStep === 1 && !selectedServerType"
                                class="btn-primary">
                            Next <i class="fas fa-arrow-right"></i>
                        </button>
                        
                        <button @click="finishSetup()" 
                                x-show="wizardStep === 3" 
                                class="btn-success"
                                :disabled="setupLoading">
                            <i class="fas fa-check"></i> 
                            <span x-text="setupLoading ? 'Configuring...' : 'Complete Setup'"></span>
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

        <script src="/js/secure-auth.js"></script>
<script src="/js/dashboard-simple.js"></script>
    <script>
        // Initialize dashboard when Alpine is ready
        document.addEventListener('alpine:init', () => {
            console.log('üöÄ Alpine.js initialized');
        });
        
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üìÑ DOM loaded');
            // Force visibility after a short delay
            setTimeout(() => {
                const mainContent = document.querySelector('.main-content');
                const tabContent = document.querySelector('.tab-content');
                if (mainContent) {
                    mainContent.style.display = 'block';
                    mainContent.style.opacity = '1';
                    mainContent.style.visibility = 'visible';
                    console.log('‚úÖ Main content forced visible');
                }
                if (tabContent) {
                    tabContent.style.display = 'block';
                    tabContent.style.opacity = '1';
                    tabContent.style.visibility = 'visible';
                    console.log('‚úÖ Tab content forced visible');
                }
            }, 500);
        });
    </script>
<script>
        // Global navigation functions
        function setActiveTab(tab) {
            console.log('Setting active tab:', tab);
            
            // Hide all tabs
            const tabs = document.querySelectorAll('[x-show*="activeTab"]');
            tabs.forEach(t => {
                t.style.display = 'none';
            });
            
            // Show selected tab
            const activeTab = document.querySelector(`[x-show*="'${tab}'"]`);
            if (activeTab) {
                activeTab.style.display = 'block';
                console.log('‚úÖ Switched to:', tab);
            }
            
            // Update navigation
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => link.classList.remove('active'));
            
            const activeNav = document.querySelector(`[onclick*="'${tab}'"]`);
            if (activeNav) {
                activeNav.classList.add('active');
            }
        }
        
        function performAction(action) {
            console.log('Performing action:', action);
            alert(`Action: ${action} - This feature is being implemented!`);
        }
            if (window.dashboardInstance) {
                switch(action) {
                    case 'lockdown':
                        window.dashboardInstance.lockdownServer();
                        break;
                    case 'pauseInvites':
                        window.dashboardInstance.pauseInvites();
                        break;
                    case 'clearRaidFlags':
                        window.dashboardInstance.clearRaidFlags();
                        break;
                    case 'emergencyMode':
                        window.dashboardInstance.emergencyMode();
                        break;
                    case 'loadData':
                        window.dashboardInstance.loadData();
                        break;
                    case 'toggleAutoRefresh':
                        window.dashboardInstance.toggleAutoRefresh();
                        break;
                }
            }
    </script>
</body>
</html>